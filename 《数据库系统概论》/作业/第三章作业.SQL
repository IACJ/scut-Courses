
# 第三章 - SQL

3. 
(1) SELECT * FROM S WHERE A = 10;
(2) SELECT A, B FROM S;
(3) SELECT A, B, S.C, S.D, E, F FROM S, T WHERE S.C=T.C AND S.D=T.D
(4) SELECT * FROM S, T WHERE S.C = T.C;
(5) SELECT * FROM S, T WHERE S.A < T.E;
(6) SELECT S.C, S.D, T.* WHERE S, T;

4. 
CREATE TABLE S (
    SNO CHAR(5) PRIMARY KEY,
    SNAME CHAR(10),
    STATUS INT,
    CITY CHAR(10)
);

CREATE TABLE P (
    PNO CHAR(5) PRIMARY KEY,
    PNAME CHAR(10),
    COLOR CHAR(10),
    WEIGHT INT
);

CREATE TABLE J (
    JNO CHAR(5) PRIMARY KEY,
    JNAME CHAR(10),
    CITY CHAR(10)
);

CREATE TABLE SPJ(
    SNO CHAR(5),
    PNO CHAR(5),
    JNO CHAR(5),
    QTY INT,
    PRIMARY KEY (SNO, PNO, JNO),
    FOREIGN KEY (SNO) REFERENCES S(SNO),
    FOREIGN KEY (PNO) REFERENCES P(PNO),
    FOREIGN KEY (JNO) REFERENCES J(JNO)
);

(1) SELECT DISTINCT SNO FROM SPJ WHERE JNO = 'J!';
(2) SELECT DISTINCT SNO FROM SPJ WHERE JNO = 'J!' AND PNO = 'P1';
(3) SELECT DISTINCT SNO FROM SPJ, P WHERE SPJ.PNO=P.PNO AND JNO='J1' AND COLOR = '红';
(4) SELECT DISTINCT JNO FROM SPJ WHERE JNO NOT IN 
(SELECT JNO FROM SPJ, P, S WHERE SPJ.PNO=P.PNO AND SPJ.SNO=S.SNO AND CITY='天津' AND COLOR='红')
(5) 分两步查询：
[1]: SELECT DISTINCT PNO FROM SPJ WHERE SMP ='S1'; [结果为（'P1','P2'）]
[2]: SELECT DISTINCT JNO FROM SPJ WHERE PNO='P1' AND JNO IN (SELECT JNO FORM SPJ WHERE PNO='P2');


5. 
(6) SELECT DISTINCT JNAME FROM SPJ, J, S WHERE SPJ.JNO=J.JNO AND SPJ.SNO =S.SNO AND S.CITY='上海';
(7) SELECT DISTINCT JNO FORM SPJ,S, WHERE SPJ.SNO =S.SNO AND S.CITY !='天津';
(8) UPDATE P SET COLOR='蓝' WHERE COLOR='蓝';
(9) UPDATE SPJ SET SNO='S3' WHERE SNO='S5' AND JNO='J4' AND PNO='P6';
(10) 分两步删除：
[1] DELETE FROM SPJ WHERE SNO='S2';
[2] DELETE FROM S WHERE SNO='S2'; 


7. 视图的优点：
(1) 视图能够简化用户的操作
(2) 视图使用户能以多种角度看待同一数据
(3) 视图对重构数据库提供了一定程度的逻辑独立性
(4) 视图能够对机密数据提供安全保护
(5) 适当的利用视图可以更清晰的表达查询

8. 
一些视图是不可更新的，因为若视图的属性来自集合函数、表达式，
对这些视图的更新不能唯一地有意义地转换成对相应基本表的更新。
例：视图S_G为不可更新视图。
UPDATE S_G
SET Gavg=90
WHERE Sno= ‘200215121’；
这个对视图的更新无法转换成对基本表SC的更新.

反之， 若视图的属性没有来自集合函数、表达式，则可更新。
UPDATE S_I
SET SNO=‘200215122’
WHERE Sno= ‘200215121’；

9. 
CREATE VIEW J1_SPQ(SNO, PNO, QTY)
AS
SELECT SNO,SPJ.PNO,QTY
FROM SPJ, J
WHERE SPJ.JNO=J.JNO AND J.JNAME='三建';

(1) SELECT DISTINCT PNO,QTY FROM J1_SPQ;
(2) SELECT DISTINCT * FROM J1_SPQ WHERE SNO='S1';